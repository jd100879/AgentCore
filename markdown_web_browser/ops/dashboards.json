{
  "description": "Grafana dashboard definitions for Markdown Web Browser ops",
  "dashboards": [
    {
      "title": "Capture & OCR Latency",
      "panels": [
        {
          "id": "capture-latency-p95",
          "type": "timeseries",
          "metrics": [
            {
              "query": "histogram_quantile(0.95, sum(rate(mdwb_capture_duration_seconds_bucket[5m])) by (le))",
              "label": "capture p95"
            },
            {
              "query": "histogram_quantile(0.95, sum(rate(mdwb_ocr_duration_seconds_bucket[5m])) by (le))",
              "label": "ocr p95"
            },
            {
              "query": "histogram_quantile(0.95, sum(rate(mdwb_stitch_duration_seconds_bucket[5m])) by (le))",
              "label": "stitch p95"
            }
          ],
          "thresholds": [
            {"value_ms": 25000, "label": "docs/articles budget"},
            {"value_ms": 45000, "label": "dashboards/apps budget"}
          ]
        },
        {
          "id": "job-throughput",
          "type": "stat",
          "metrics": [
            {
              "query": "sum(rate(mdwb_job_completions_total{state=\"DONE\"}[5m]))",
              "label": "jobs/min (done)"
            },
            {
              "query": "sum(rate(mdwb_job_completions_total{state=\"FAILED\"}[5m]))",
              "label": "jobs/min (failed)"
            }
          ]
        }
      ]
    },
    {
      "title": "Smoke Run Health",
      "panels": [
        {
          "id": "smoke-success",
          "type": "table",
          "metrics": [
            {
              "query": "sum(increase(mdwb_job_completions_total{state=\"DONE\"}[1d]))",
              "label": "jobs done (24h)"
            },
            {
              "query": "sum(increase(mdwb_job_completions_total{state=\"FAILED\"}[1d]))",
              "label": "jobs failed (24h)"
            }
          ],
          "notes": "Job completion counters sourced from Prometheus so smoke dashboards can alert without parsing manifests."
        },
        {
          "id": "weekly-summary-json",
          "type": "text",
          "content": "Link to latest benchmarks/production/weekly_summary.json artifact for manual review."
        }
      ]
    },
    {
      "title": "SSE & Frontend",
      "panels": [
        {
          "id": "sse-heartbeat",
          "type": "timeseries",
          "metrics": [
            {
              "query": "rate(mdwb_sse_heartbeat_total[5m])",
              "label": "heartbeats/sec"
            }
          ],
          "thresholds": [
            {"value": 0.1, "label": "min heartbeat rate"}
          ]
        },
        {
          "id": "warning-volume",
          "type": "bar-gauge",
          "metrics": [
            {
              "query": "sum(increase(mdwb_capture_warnings_total[1h])) by (code)",
              "label": "warnings/hr"
            }
          ]
        },
        {
          "id": "blocklist-hits",
          "type": "bar-gauge",
          "metrics": [
            {
              "query": "sum(increase(mdwb_blocklist_hits_total[1h])) by (selector)",
              "label": "blocklist hits/hr"
            }
          ]
        }
      ]
    }
  ]
}
