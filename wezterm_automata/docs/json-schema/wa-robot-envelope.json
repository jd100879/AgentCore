{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wezterm-automata.dev/schemas/wa-robot-envelope.json",
  "title": "WA Robot Response Envelope",
  "description": "Standard JSON envelope for all wa robot mode responses. Every robot command returns this structure with command-specific data in the 'data' field.",
  "type": "object",
  "required": ["ok", "elapsed_ms", "version", "now"],
  "properties": {
    "ok": {
      "type": "boolean",
      "description": "Whether the command succeeded. When true, 'data' contains the result. When false, 'error' and 'error_code' describe the failure."
    },
    "data": {
      "description": "Command-specific response data. Present when ok=true. Type depends on the specific command."
    },
    "error": {
      "type": "string",
      "description": "Human-readable error message. Present when ok=false."
    },
    "error_code": {
      "type": "string",
      "description": "Machine-readable error code for programmatic handling. Present when ok=false. Format: 'robot.<category>' (e.g., 'robot.wezterm_error', 'robot.not_implemented').",
      "pattern": "^robot\\.[a-z_]+$"
    },
    "hint": {
      "type": "string",
      "description": "Actionable suggestion for resolving the error. Present when ok=false and a remediation is known."
    },
    "elapsed_ms": {
      "type": "integer",
      "minimum": 0,
      "description": "Time taken to execute the command in milliseconds."
    },
    "version": {
      "type": "string",
      "description": "wa version string (semver format).",
      "pattern": "^\\d+\\.\\d+\\.\\d+.*$"
    },
    "now": {
      "type": "integer",
      "minimum": 0,
      "description": "Unix timestamp in milliseconds when the response was generated."
    }
  },
  "if": {
    "properties": { "ok": { "const": true } }
  },
  "then": {
    "required": ["data"]
  },
  "else": {
    "required": ["error", "error_code"]
  },
  "$defs": {
    "error_codes": {
      "title": "Standard Robot Error Codes",
      "description": "Well-known error codes returned by robot commands",
      "enum": [
        "robot.invalid_args",
        "robot.unknown_subcommand",
        "robot.not_implemented",
        "robot.config_error",
        "robot.wezterm_error",
        "robot.storage_error",
        "robot.policy_denied",
        "robot.pane_not_found",
        "robot.workflow_error",
        "robot.timeout"
      ]
    }
  }
}
